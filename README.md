# ะกะธััะตะผะฐ ะกะฒะตัะพัะพัะฐ ั ะธะฝัะตะณัะฐัะธะตะน JIRA

ะฃะฟัะพัะตะฝะฝะฐั ะฒะตััะธั ัะธััะตะผั ัะฒะตัะพัะพัะฐ ัะพะปัะบะพ ั JIRA ะธะฝัะตะณัะฐัะธะตะน, ะฑะตะท Telegram ะฑะพัะพะฒ.

## ะะฟะธัะฐะฝะธะต

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะฐัะธะฒะฐะตั JIRA ะฝะฐ ะฝะฐะปะธัะธะต ะฝะพะฒัั ะธะฝัะธะดะตะฝัะพะฒ ะธ ะพัะฟัะฐะฒะปัะตั ัะธะณะฝะฐะปั ัะฒะตัะพัะพัะฐ ะฝะฐ ะบะปะธะตะฝััะบะธะต ะฟัะธะปะพะถะตะฝะธั:

- **ะัะฐัะฝัะน ะผะธะณะฐััะธะน** ๐ด - ะธะฝัะธะดะตะฝั ะฒััะพะบะพะณะพ/ะบัะธัะธัะฝะพะณะพ ะฟัะธะพัะธัะตัะฐ
- **ะะตะปััะน ะผะธะณะฐััะธะน** ๐ก - ะธะฝัะธะดะตะฝั ััะตะดะฝะตะณะพ/ะฝะธะทะบะพะณะพ ะฟัะธะพัะธัะตัะฐ
- **ะะตะปะตะฝัะน** ๐ข - ะพัะตัะตะดั (ัะฟัะฐะฒะปัะตััั ะฒัััะฝัั ะฐะดะผะธะฝะธัััะฐัะพัะพะผ)

## ะะพะผะฟะพะฝะตะฝัั

1. **ะกะตัะฒะตั** - WebSocket ัะตัะฒะตั + JIRA polling
2. **ะะปะธะตะฝั** - ะัะฐัะธัะตัะบะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฒะตัะพัะพั ะฒ ะฟัะฐะฒะพะผ ะฝะธะถะฝะตะผ ัะณะปั ัะบัะฐะฝะฐ)

## ะขัะตะฑะพะฒะฐะฝะธั

- Java 17 ะธะปะธ ะฒััะต
- Maven 3.6+
- ะะพัััะฟ ะบ JIRA (URL, ะปะพะณะธะฝ, ะฟะฐัะพะปั/ัะพะบะตะฝ)

## โ๏ธ ะะตะทะพะฟะฐัะฝะพััั

**ะะะะะ**: ะัะพะตะบั ะธัะฟะพะปัะทัะตั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะดะปั ััะฐะฝะตะฝะธั ััะตัะฝัั ะดะฐะฝะฝัั. ะะธะบะพะณะดะฐ ะฝะต ะบะพะผะผะธัััะต ะฟะฐัะพะปะธ ะฒ git!

ะกะผ. ะฟะพะดัะพะฑะฝัั ะธะฝััััะบัะธั: **[DEPLOYMENT.md](DEPLOYMENT.md)**

## ะัััััะน ััะฐัั

### 1. ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ

```bash
cd onlyjirasvetofor
mvn clean package
```

ะะพัะปะต ััะฟะตัะฝะพะน ัะฑะพัะบะธ ะฒ ะฟะฐะฟะบะต `target/` ะฟะพัะฒัััั:
- `svetoofor-server.jar` - ัะตัะฒะตัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
- `svetoofor-client.jar` - ะบะปะธะตะฝััะบะพะต ะฟัะธะปะพะถะตะฝะธะต
- `svetoofor-installer.jar` - ัััะฐะฝะพะฒัะธะบ ะดะปั Windows

### 2. ะะฐัััะพะนะบะฐ ััะตัะฝัั ะดะฐะฝะฝัั (ะะตะทะพะฟะฐัะฝัะน ัะฟะพัะพะฑ)

**ะัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:**

```bash
export JIRA_URL="https://jiraportal.cbk.kg"
export JIRA_USERNAME="incident"
export JIRA_PASSWORD="your_secure_password"
```

**ะะปะธ ัะพะทะดะฐะนัะต .env ัะฐะนะป** (ะฝะต ะทะฐะฑัะดััะต ะดะพะฑะฐะฒะธัั ะฒ .gitignore!):

```bash
cp deploy/env.example .env
nano .env
source .env
```

### 3. ะะฐัััะพะนะบะฐ ัะตัะฒะตัะฐ (Legacy)

ะัะปะธ ะฒั ะฒัั ะตัั ัะพัะธัะต ะธัะฟะพะปัะทะพะฒะฐัั server.properties (ะฝะต ัะตะบะพะผะตะฝะดัะตััั):

```properties
# ะะพัั WebSocket ัะตัะฒะตัะฐ
server.port=52521

# JIRA ะฝะฐัััะพะนะบะธ
jira.url=https://jiraportal.cbk.kg
jira.username=YOUR_JIRA_USERNAME
jira.password=YOUR_JIRA_PASSWORD_OR_TOKEN
jira.issue.type=11206
jira.poll.interval=5
```

### 3. ะะฐะฟััะบ ัะตัะฒะตัะฐ

```bash
java -jar target/svetoofor-server.jar
```

ะกะตัะฒะตั ะทะฐะฟัััะธััั ะธ ะฝะฐัะฝะตั:
1. ะัะพัะปััะธะฒะฐัั WebSocket ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะฟะพััั 52521
2. ะะฟัะฐัะธะฒะฐัั JIRA ะบะฐะถะดัะต 5 ะผะธะฝัั (ะธะปะธ ัะพะณะปะฐัะฝะพ ะฝะฐัััะพะนะบะต)
3. ะัะฟัะฐะฒะปััั ัะธะณะฝะฐะปั ัะฒะตัะพัะพัะฐ ะฟัะธ ะพะฑะฝะฐััะถะตะฝะธะธ ะฝะพะฒัั ะธะฝัะธะดะตะฝัะพะฒ

### 4. ะะฐัััะพะนะบะฐ ะบะปะธะตะฝัะฐ

ะกะบะพะฟะธััะนัะต ะธ ะพััะตะดะฐะบัะธััะนัะต:

```bash
cp client.properties.example client.properties
nano client.properties
```

```properties
# ะะดัะตั ะธ ะฟะพัั ัะตัะฒะตัะฐ
server.address=10.10.90.170
server.port=52521

# ะฃัะตัะฝัะต ะดะฐะฝะฝัะต ะฐะดะผะธะฝะธัััะฐัะพัะฐ (ะพััะฐะฒััะต ะฟััััะผ ะดะปั ัะตะถะธะผะฐ ัะฟะตัะธะฐะปะธััะฐ)
admin.login=
admin.password=
```

### 5. ะะฐะฟััะบ ะบะปะธะตะฝัะฐ

```bash
java -jar target/svetoofor-client.jar
```

## ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ ัะตัะฒะตัะต (Linux)

### ะฃััะฐะฝะพะฒะบะฐ ะบะฐะบ systemd ัะตัะฒะธั

1. ะกะบะพะฟะธััะนัะต JAR ัะฐะนะป:

```bash
sudo mkdir -p /opt/svetoofor
sudo cp target/svetoofor-server.jar /opt/svetoofor/
sudo cp server.properties /opt/svetoofor/
```

2. ะกะพะทะดะฐะนัะต systemd unit `/etc/systemd/system/svetoofor.service`:

```ini
[Unit]
Description=Traffic Light Server with JIRA Integration
After=network.target

[Service]
Type=simple
User=svetoofor
WorkingDirectory=/opt/svetoofor
ExecStart=/usr/bin/java -jar /opt/svetoofor/svetoofor-server.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

3. ะกะพะทะดะฐะนัะต ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะฝะฐัััะพะนัะต ะฟัะฐะฒะฐ:

```bash
sudo useradd -r -s /bin/false svetoofor
sudo chown -R svetoofor:svetoofor /opt/svetoofor
```

4. ะะฐะฟัััะธัะต ัะตัะฒะธั:

```bash
sudo systemctl daemon-reload
sudo systemctl enable svetoofor
sudo systemctl start svetoofor
sudo systemctl status svetoofor
```

5. ะัะพัะผะพัั ะปะพะณะพะฒ:

```bash
sudo journalctl -u svetoofor -f
```

## ะะฐะทะฒะตัััะฒะฐะฝะธะต ะบะปะธะตะฝัะฐ ะฝะฐ Windows

### ะะฐัะธะฐะฝั A: ะะฒัะพะผะฐัะธัะตัะบะฐั ัััะฐะฝะพะฒะบะฐ

1. ะะฐะฟัััะธัะต `svetoofor-installer.jar`
2. ะะฒะตะดะธัะต ะฐะดัะตั ัะตัะฒะตัะฐ (10.10.90.170)
3. ะะฒะตะดะธัะต ะฟะพัั (52521)
4. ะััะฐะฒััะต ะปะพะณะธะฝ/ะฟะฐัะพะปั ะฟััััะผะธ ะดะปั ัะตะถะธะผะฐ ัะฟะตัะธะฐะปะธััะฐ
5. ะะฐะถะผะธัะต "ะฃััะฐะฝะพะฒะธัั"

ะะปะธะตะฝั ะฑัะดะตั ัััะฐะฝะพะฒะปะตะฝ ะฒ `C:\TrafficLight\` ะธ ะดะพะฑะฐะฒะปะตะฝ ะฒ ะฐะฒัะพะทะฐะณััะทะบั.

### ะะฐัะธะฐะฝั B: ะััะฝะฐั ัััะฐะฝะพะฒะบะฐ

```cmd
mkdir C:\TrafficLight
copy target\svetoofor-client.jar C:\TrafficLight\
copy client.properties C:\TrafficLight\
```

ะกะพะทะดะฐะนัะต ััะปัะบ ะดะปั ะทะฐะฟััะบะฐ:
```cmd
java -jar C:\TrafficLight\svetoofor-client.jar
```

## ะะฐัััะพะนะบะฐ JIRA ะธะฝัะตะณัะฐัะธะธ

### ะคะพัะผะฐั JQL ะทะฐะฟัะพัะฐ

ะกะตัะฒะตั ะธัะฟะพะปัะทัะตั ัะปะตะดัััะธะน JQL ะทะฐะฟัะพั:
```
issuetype = 11206 AND updated >= -5m
```

ะะดะต:
- `11206` - ัะธะฟ ะธะฝัะธะดะตะฝัะฐ (ะฝะฐัััะฐะธะฒะฐะตััั ะฒ `jira.issue.type`)
- `-5m` - ะฟะพัะปะตะดะฝะธะต 5 ะผะธะฝัั (ะทะฐะฒะธัะธั ะพั `jira.poll.interval`)

### ะัะธะพัะธัะตัั

ะกะธััะตะผะฐ ะพะฟัะตะดะตะปัะตั ะฟัะธะพัะธัะตั ะธะฝัะธะดะตะฝัะฐ ะฟะพ ะฟะพะปั `priority`:

- **ะัะธัะธัะฝัะน/ะััะพะบะธะน** โ ะัะฐัะฝัะน ะผะธะณะฐััะธะน ัะฒะตัะพัะพั (120 ัะตะบ)
- **ะกัะตะดะฝะธะน/ะะธะทะบะธะน** โ ะะตะปััะน ะผะธะณะฐััะธะน ัะฒะตัะพัะพั (120 ัะตะบ)

ะัะธัะตัะธะธ ะพะฟัะตะดะตะปะตะฝะธั:
1. ะะพ ะธะผะตะฝะธ: "ะบัะธัะธัะฝัะน", "ะฒััะพะบะธะน", "critical", "high"
2. ะะพ ID ะฟัะธะพัะธัะตัะฐ: 1-2 = ะฒััะพะบะธะน, 3 = ััะตะดะฝะธะน, 4+ = ะฝะธะทะบะธะน

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
โ    JIRA     โโโโโโโโถโ   ะกะตัะฒะตั     โโโโโโโโโ   ะะปะธะตะฝั 1   โ
โ  REST API   โ Poll  โ  WebSocket   โ  WS   โ  (ะกะฒะตัะพัะพั)  โ
โโโโโโโโโโโโโโโ 5min  โ   :52521      โ       โโโโโโโโโโโโโโโโ
                       โ              โ       โโโโโโโโโโโโโโโโ
                       โ  + JIRA      โโโโโโโโโ   ะะปะธะตะฝั 2   โ
                       โ    Poller    โ  WS   โ  (ะกะฒะตัะพัะพั)  โ
                       โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
                                              โโโโโโโโโโโโโโโโ
                                         โโโโโโ  ะะปะธะตะฝั 200  โ
                                         WS   โ  (ะกะฒะตัะพัะพั)  โ
                                              โโโโโโโโโโโโโโโโ
```

### Workflow

1. **JiraPoller** ะพะฟัะฐัะธะฒะฐะตั JIRA ะบะฐะถะดัะต N ะผะธะฝัั
2. ะัะธ ะพะฑะฝะฐััะถะตะฝะธะธ ะฝะพะฒะพะณะพ ะธะฝัะธะดะตะฝัะฐ:
   - ะะฟัะตะดะตะปัะตั ะฟัะธะพัะธัะตั
   - ะัะฟัะฐะฒะปัะตั ัะธะณะฝะฐะป ะฝะฐ **TrafficLightServer**
3. **TrafficLightServer** ัะฐัััะปะฐะตั ัะธะณะฝะฐะป ะฒัะตะผ ะฟะพะดะบะปััะตะฝะฝัะผ ะบะปะธะตะฝัะฐะผ
4. **ะะปะธะตะฝัั** ะพัะพะฑัะฐะถะฐัั ัะฒะตัะพัะพั ะฒ ะฟัะฐะฒะพะผ ะฝะธะถะฝะตะผ ัะณะปั ัะบัะฐะฝะฐ

## ะกะธะณะฝะฐะปั ัะฒะตัะพัะพัะฐ

| ะกะธะณะฝะฐะป       | ะะฟะธัะฐะฝะธะต                           | ะะปะธัะตะปัะฝะพััั |
|--------------|-----------------------------------|--------------|
| RED_BLINK    | ะะฝัะธะดะตะฝั ะฒััะพะบะพะณะพ ะฟัะธะพัะธัะตัะฐ      | 120 ัะตะบ      |
| YELLOW_BLINK | ะะฝัะธะดะตะฝั ััะตะดะฝะตะณะพ ะฟัะธะพัะธัะตัะฐ      | 120 ัะตะบ      |
| GREEN        | ะัะตัะตะดั (ัะฟัะฐะฒะปัะตััั ะฒัััะฝัั)     | ะะพ ัะฝััะธั    |

## ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

### ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ JIRA

```bash
curl -u username:password "https://jiraportal.cbk.kg/rest/api/2/myself"
```

### ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ัะตัะฒะตัะฐ

```bash
# ะัะพะฒะตัะบะฐ ะฟะพััะฐ
netstat -tulpn | grep 52521

# ะัะพะฒะตัะบะฐ WebSocket ัะพะตะดะธะฝะตะฝะธั
wscat -c ws://10.10.90.170:52521
```

### ะะพะณะธ ัะตัะฒะตัะฐ

```bash
# ะัะปะธ ะทะฐะฟััะตะฝะพ ะบะฐะบ systemd ัะตัะฒะธั
sudo journalctl -u svetoofor -f

# ะัะปะธ ะทะฐะฟััะตะฝะพ ะฒัััะฝัั
# ะกะผะพััะธัะต ะบะพะฝัะพะปั
```

## ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะกะตัะฒะตั ะฝะต ะทะฐะฟััะบะฐะตััั

1. ะัะพะฒะตัััะต ะฟะพัั 52521:
   ```bash
   lsof -i :52521
   ```

2. ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั JIRA ะฒ `server.properties`

3. ะัะพะฒะตัััะต ะปะพะณะธ:
   ```bash
   sudo journalctl -u svetoofor -n 50
   ```

### ะะปะธะตะฝั ะฝะต ะฟะพะดะบะปััะฐะตััั

1. ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ัะตัะฒะตัะฐ:
   ```bash
   telnet 10.10.90.170 52521
   ```

2. ะัะพะฒะตัััะต ัะฐะนัะฒะพะป ะฝะฐ ัะตัะฒะตัะต:
   ```bash
   sudo ufw allow 52521/tcp
   ```

3. ะัะพะฒะตัััะต `client.properties` - ะฟัะฐะฒะธะปัะฝัะน ะปะธ ะฐะดัะตั ัะตัะฒะตัะฐ

### JIRA ะธะฝัะตะณัะฐัะธั ะฝะต ัะฐะฑะพัะฐะตั

1. ะัะพะฒะตัััะต ะฟะพะดะบะปััะตะฝะธะต ะบ JIRA:
   ```bash
   curl -u username:password "https://jiraportal.cbk.kg/rest/api/2/myself"
   ```

2. ะัะพะฒะตัััะต JQL ะทะฐะฟัะพั ะฒัััะฝัั ะฒ JIRA

3. ะัะพะฒะตัััะต ะฟัะฐะฒะฐ ะฟะพะปัะทะพะฒะฐัะตะปั JIRA

4. ะะพัะผะพััะธัะต ะปะพะณะธ ัะตัะฒะตัะฐ ะฝะฐ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ

## ะะฐะทะปะธัะธั ั ะฟะพะปะฝะพะน ะฒะตััะธะตะน

ะญัะฐ ะฒะตััะธั **ะะ ะฒะบะปััะฐะตั**:
- Telegram ะฑะพัะพะฒ (IncidentBot, AlertBot)
- Telegram API ะทะฐะฒะธัะธะผะพััะธ
- ะัะฟัะฐะฒะบั ัะฒะตะดะพะผะปะตะฝะธะน ะฒ Telegram

ะญัะฐ ะฒะตััะธั **ะฒะบะปััะฐะตั**:
- WebSocket ัะตัะฒะตั
- JIRA ะธะฝัะตะณัะฐัะธั
- ะะปะธะตะฝััะบะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฒะตัะพัะพั)
- ะัะต ะพัะฝะพะฒะฝัะต ััะฝะบัะธะธ ัะฒะตัะพัะพัะฐ

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
onlyjirasvetofor/
โโโ pom.xml                          # Maven ะบะพะฝัะธะณััะฐัะธั (ะฑะตะท Telegram)
โโโ src/main/java/incuat/kg/svetoofor/
โ   โโโ ServerLauncher.java          # ะขะพัะบะฐ ะฒัะพะดะฐ ัะตัะฒะตัะฐ
โ   โโโ TrafficLightServer.java      # WebSocket ัะตัะฒะตั
โ   โโโ TrafficLightApp.java         # ะะปะธะตะฝััะบะพะต ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ InstallerGUI.java            # ะฃััะฐะฝะพะฒัะธะบ ะดะปั Windows
โ   โโโ jira/
โ       โโโ JiraClient.java          # HTTP ะบะปะธะตะฝั ะดะปั JIRA API
โ       โโโ JiraPoller.java          # ะะฟัะพั JIRA
โ       โโโ JiraIssue.java           # ะะพะดะตะปั ะธะฝัะธะดะตะฝัะฐ
โ       โโโ JiraSearchResult.java    # ะะตะทัะปััะฐั ะฟะพะธัะบะฐ
โโโ server.properties.example        # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ ัะตัะฒะตัะฐ
โโโ client.properties.example        # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ ะบะปะธะตะฝัะฐ
โโโ README.md                        # ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
```

## ะะธัะตะฝะทะธั

ะัะพะตะบั ะดะปั ะฒะฝัััะตะฝะฝะตะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั incuat.kg

## ะะพะดะดะตัะถะบะฐ

- Email: support@incuat.kg
- GitHub Issues (ะตัะปะธ ะฟัะธะผะตะฝะธะผะพ)
